<!DOCTYPE html>
<html>
<head>
  <title>ML Test</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script>
    function handleFileSelect(event) {
      const file = event.target.files[0];
      const reader = new FileReader();

      reader.onload = async function (e) {
        const csv = e.target.result;
        const processedData = processCSV(csv);
        const formattedData = processedData.map(item => item.join(', ')).join('<br>');
        document.getElementById('display_data').innerHTML = formattedData;

        // Preprocess the training data (normalization)
        const normalizedTrainingData = processedData.map((data) => [
          data[0] / 5, // Food ID (Normalized)
          data[1] / 140, // Number of Orders (Normalized)
          data[2] / 7 // Day of the Week (Normalized)
        ]);

        // Convert the training data to TensorFlow tensors
        const trainingDataTensor = tf.tensor2d(normalizedTrainingData.map((data) => data.slice(0, 2))); // Use food ID and day of the week
        const trainingLabelsTensor = tf.tensor2d(normalizedTrainingData.map((data) => [data[1]])); // Use only the number of orders as labels

        // Create the model
        const model = tf.sequential();
        model.add(tf.layers.dense({ units: 1, inputShape: [2] }));

        // Compile the model
        model.compile({ loss: 'meanSquaredError', optimizer: 'sgd' });

        // Train the model
        async function trainModel() {
          await model.fit(trainingDataTensor, trainingLabelsTensor, { epochs: 500 });
        }

        await trainModel(); // Await the completion of model training

        // Predict the number of orders for the input values
        function predictOrders() {
          // Get the inputs from the user
          const foodId = Number(document.getElementById('food-id-input').value) / 5; // Normalize the input
          const dayOfWeek = Number(document.getElementById('day-of-week-input').value) / 7; // Normalize the input

          // Prepare the input tensor for prediction
          const inputTensor = tf.tensor2d([[foodId, dayOfWeek]]);

          // Make the prediction
          const normalizedPrediction = model.predict(inputTensor).dataSync()[0];

          // Denormalize the prediction using the scaling factor for the number of orders
          const prediction = normalizedPrediction * 140; // Scaling factor for the number of orders

          // Display the prediction
          const outputContainer = document.getElementById('output-container');
          outputContainer.innerHTML = '<h3>Prediction:</h3>';
          outputContainer.innerHTML += '<p>Food ID: ' + foodId * 5 + '</p>';
          outputContainer.innerHTML += '<p>Day of the Week: ' + dayOfWeek * 7 + '</p>';
          outputContainer.innerHTML += '<p>Number of Orders: ' + prediction.toFixed(2) + '</p>';
        }

        // Assign the predictOrders function to the button onclick event
        document.getElementById('predict-button').onclick = predictOrders;
      };

      reader.readAsText(file);
    }

    function processCSV(csv) {
      const rows = csv.split('\n');
      const data = [];

      for (let i = 0; i < rows.length; i++) {
        const row = rows[i].trim(); // Trim whitespace from the row
        if (row !== "") { // Skip empty rows
          const columns = row.split(',');
          const foodId = parseInt(columns[0]);
          const orders = parseInt(columns[1]);
          const dayOfWeek = parseInt(columns[2]);
          const item = [foodId, orders, dayOfWeek];
          data.push(item);
        }
      }

      return data;
    }
  </script>
</head>

<body>
  <h1>Multiple Linear Regression</h1>
  <input type="file" accept=".csv" onchange="handleFileSelect(event)" />
  <div id="display_data"></div>
  <div>
    <label for="food-id-input">Food ID:</label>
    <input type="number" id="food-id-input" step="1" min="1" max="5">
    <label for="day-of-week-input">Day of the Week:</label>
    <input type="number" id="day-of-week-input" step="1" min="1" max="7">
  </div>
  <button id="predict-button">Predict</button>
  <div id="output-container"></div>
</body>
</html>
